Ã‹

    Ã°Â­g  Ã£                   Ã³:   â€” d dl mZ d	dâ€Zdâ€ Zdâ€ Zdâ€ Zd	dâ€Zd
dâ€Zy)Ã©    )ÃšMySQLdbc                 Ã³Ã´   â€” |dk(  rd}nd|â€º Â}d|â€º dÂ}| j                   j                  t        j                  j                  Â«      }|j                  |Â«       |j
                  Â«       }|j                  Â«        |S )Nr   Ãš ÃºLIMIT uÂ¹  
        -- Seleciona os campos abaixo
        SELECT art_id, art_title, art_resume, art_thumbnail
        -- desta tabela
        FROM article
        -- art_status ÃƒÂ© 'on'
        WHERE art_status = 'on'
            -- E art_date ÃƒÂ© menor ou igual ÃƒÂ  data atual
            -- NÃƒÂ£o obtÃƒÂ©m artigos com data futura (agendados)
            AND art_date <= NOW()
        -- Ordena pela data mais recente
        ORDER BY art_date DESC
        Ãº
    Â©Ãš
connectionÃšcursorr   ÃšcursorsÃš
DictCursorÃšexecuteÃšfetchallÃšclose)ÃšmysqlÃšlimitÃšsubsqlÃšsqlÃšcurÃšarticless         ÃºOC:\Users\andre.ataide\Luferat\Python\jocablog\JocaBlog\functions\db_articles.pyÃšget_allr      sy   â‚¬ Ã Ââ€šzÃ˜â€°Ã Ëœ%ËœÃ!Ë†Ã°	Ã° 
Ë†Ã° Ã°
â‚¬CÃ° Ã—
Ã‘
Ã—
!Ã‘
!Â¤'Â§/Â¡/Ã—"<Ã‘"<Ã“
=â‚¬CÃ˜â€¡KÂKÂÃ”Ã˜Â|â€°|â€¹~â‚¬HÃ˜â€¡IÂIâ€KÃ â‚¬OÃ³    c                 Ã³Ã–   â€” d}| j                   j                  t        j                  j                  Â«      }|j                  ||fÂ«       |j
                  Â«       }|j                  Â«        |S )Nu  
        SELECT 
            -- Campos do artigo
            art_id, art_date, art_title, art_content,
            -- Campos do autor
            sta_id, sta_name, sta_image, sta_description, sta_type,
            -- Campos especiais
            -- ObtÃƒÂ©m a data em PT-BR pelo pseudo-campo `art_datebr`
            DATE_FORMAT(art_date, '%%d/%%m/%%Y ÃƒÂ s %%H:%%i') AS art_datebr,            
            -- Calcula a idade para `sta_age` considerando ano, mÃƒÂªs e dia de nascimento
            TIMESTAMPDIFF(YEAR, sta_birth, CURDATE()) - (DATE_FORMAT(CURDATE(), '%%m%%d') < DATE_FORMAT(sta_birth, '%%m%%d')) AS sta_age
        FROM article
        INNER JOIN staff ON art_author = sta_id
        WHERE art_id = %s
            AND art_status = 'on'
            AND art_date <= NOW();
    )r	   r
   r   r   r   r
   Ãšfetchoner   )r   Ãšartidr   r   Ãšarticles        r   Ãšget_oner   !   sT   â‚¬ Ã°â‚¬CÃ°" Ã—
Ã‘
Ã—
!Ã‘
!Â¤'Â§/Â¡/Ã—"<Ã‘"<Ã“
=â‚¬CÃ˜â€¡KÂKÂÂeÂXÃ”Ã˜Âlâ€°lâ€¹nâ‚¬GÃ˜â€¡IÂIâ€KÃ â‚¬Nr   c                 Ã³Ã¨   â€” d}| j                   j                  t        j                  j                  Â«      }|j                  ||fÂ«       | j                   j
                  Â«        |j                  Â«        y)Nz<UPDATE article SET art_view = art_view + 1 WHERE art_id = %sT)r	   r
   r   r   r   r
   Ãšcommitr   )r   r   r   r   s       r   Ãšupdate_viewsr    <   sU   â‚¬ Ã 
Hâ‚¬CÃ˜
Ã—
Ã‘
Ã—
!Ã‘
!Â¤'Â§/Â¡/Ã—"<Ã‘"<Ã“
=â‚¬CÃ˜â€¡KÂKÂÂeÂXÃ”Ã˜	Ã—Ã‘Ã—Ã‘Ã”Ã˜â€¡IÂIâ€KÃ r   c                 Ã³Ãš   â€” d}| j                   j                  t        j                  j                  Â«      }|j                  ||||fÂ«       |j
                  Â«       }|j                  Â«        |S )Nu!  
        -- ObtÃƒÂ©m (id, title, thumbnail)
        SELECT art_id, art_title, art_thumbnail
        -- da table `article`
        FROM article
        -- Do author com o id `art_author`
        WHERE art_author = %s
        -- Cujo status ÃƒÂ© 'on'
            AND art_status = 'on'
            -- Cuja data de publicaÃƒÂ§ÃƒÂ£o estÃƒÂ¡ no passado
            AND art_date <= NOW()
            -- NÃƒÂ£o obtÃƒÂ©m o artigo atual
            AND art_id != %s
        -- Em ordem aleatÃƒÂ³ria
        ORDER BY RAND()
        -- AtÃƒÂ© 4 artigos
        LIMIT %s;
    r   )r   Ãšstaidr   r   r   r   r   s          r   Ãš
get_authorr#   G   sY   â‚¬ Ã°â‚¬CÃ°$ Ã—
Ã‘
Ã—
!Ã‘
!Â¤'Â§/Â¡/Ã—"<Ã‘"<Ã“
=â‚¬CÃ˜â€¡KÂKÂÂeËœUÂ EÃ,Ã”-Ã˜Â|â€°|â€¹~â‚¬HÃ˜â€¡IÂIâ€KÃ â‚¬Or   c                 Ã³  â€” |dk(  rd}nd|â€º Â}d|â€º dÂ}d|â€º dÂ}| j                   j                  t        j                  j                  Â«      }|j                  ||||fÂ«       |j
                  Â«       }|j                  Â«        |S )Nr   r   r   aK  
        SELECT art_id, art_title, art_resume, art_thumbnail
        FROM article
        WHERE (
                art_title LIKE %s
                OR art_resume LIKE %s
                OR art_content  LIKE %s
            )
            AND art_status = 'on'
            AND art_date <= NOW()
        ORDER BY art_date DESC
        r   Ãš%r   )r   Ãšqueryr   r   r   Ãš	like_termr   r   s           r   Ãšarticles_searchr(   c   sÂ   â‚¬ Ã Ââ€šzÃ˜â€°Ã Ëœ%ËœÃ!Ë†Ã°	Ã° 
Ë†Ã° Ã°â‚¬CÃ° ÂEÂ7Ëœ!Ââ‚¬IÃ˜
Ã—
Ã‘
Ã—
!Ã‘
!Â¤'Â§/Â¡/Ã—"<Ã‘"<Ã“
=â‚¬CÃ˜â€¡KÂKÂÂiÂ Â¨IÃ8Ã”9Ã˜Â|â€°|â€¹~â‚¬HÃ˜â€¡IÂIâ€KÃ â‚¬Or   c                 Ã³Ã–   â€” d}| j                   j                  t        j                  j                  Â«      }|j                  ||fÂ«       |j
                  Â«       }|j                  Â«        |S )NuA  
        -- Seleciona os campos e a contagem de comentÃƒÂ¡rios
        SELECT 
            a.art_id, 
            a.art_title,
            a.art_thumbnail, 
            COUNT(c.com_id) AS comment_count
        FROM 
            article a
        -- Faz um LEFT JOIN com a tabela comment, contando apenas os comentÃƒÂ¡rios cujo com_status ÃƒÂ© 'on'
        LEFT JOIN 
            comment c ON a.art_id = c.com_article AND c.com_status = 'on'
        -- Filtra os artigos para incluir apenas aqueles cujo art_status ÃƒÂ© 'on' e art_date ÃƒÂ© menor ou igual a NOW()
        WHERE 
            a.art_status = 'on' 
            AND a.art_date <= NOW()
        -- Agrupa os resultados por art_id, art_title
        GROUP BY 
            a.art_id, a.art_title
        -- Filtra os grupos para incluir apenas aqueles com contagem de comentÃƒÂ¡rios maior que zero
        HAVING 
            comment_count > 0
        -- Ordena os resultados pela contagem de comentÃƒÂ¡rios em ordem decrescente
        ORDER BY 
            comment_count DESC
        -- Limita os resultados a # registros
        LIMIT %s;
    r   )r   r   r   r   r   s        r   Ãšmost_commentedr*   â‚¬   sT   â‚¬ Ã°â‚¬CÃ°8 Ã—
Ã‘
Ã—
!Ã‘
!Â¤'Â§/Â¡/Ã—"<Ã‘"<Ã“
=â‚¬CÃ˜â€¡KÂKÂÂeÂXÃ”Ã˜Â|â€°|â€¹~â‚¬HÃ˜â€¡IÂIâ€KÃ â‚¬Or   N)r   )Ã©   )Ãš
flask_mysqldbr   r   r   r    r#   r(   r*   Â© r   r   Ãš<module>r.      s&   Ã°Ã !Ã³Ã²:Ã²6Ã²Ã³8Ã´:"r   